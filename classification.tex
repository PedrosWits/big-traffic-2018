% !TEX root = paper.tex
\section{Clustering vehicles}\label{s.classification}

One direct application of trip data is unsupervised learning. In this section we identify groups of vehicles with similar trip patterns based on frequency and diversity of travel. Clusters can represent private vehicles, such as work-home commuters, transit vehicles like buses and taxis, or other types of vehicles such as delivery trucks.
%This in turn, may enable trip modes to be estimated
%However, due to its limited coverage of the road network, it is not clear how well ANPR data can capture much the travel characteristics necessary to accurately describe the different groups.

Due to distinctly different traffic behaviour during weekends, we chose to consider only trips occurring during weekdays. We thus used all number-plate data collected between the 6th and 24th of February and exclude data from the 2 weekends in-between. Furthermore, as mentioned in section~\ref{s.trips}, we used fixed empirical values for $\Tau$. Table~\ref{t:trips-tau} displays the number of trips, average trip length and the proportion of trips of length one, for varying values of $\Tau$. The effect of incrementing $\Tau$ on resulting trips is clear: increased trip lengths and decreased trips containing just a single sighting. On the other hand, we did not set a value for $\tau$, but instead handled implausible trips by filtering all sightings with confidence below 85\%. Duplicates were filtered after identifying consecutive sightings by the same camera occurring within the same trip. Clock synchronisation errors were provided in milliseconds with none exceeding 5 seconds. These were therefore ignored.

\begin{table}[t]
\centering
\tabcolsep=0.25cm
\begin{tabular}{c c c c}
  \hline
Tau & Trips & \thead{Average\\Length} & \thead{Proportion of Trips \\ Length 1} \\
  \hline
5 min & 13,603,759 & 1.46 & 0.70 \\
7.5 min & 12,394,709 & 1.60 & 0.64 \\
10 min & 11,690,791 & 1.69 & 0.61 \\
15 min & 10,823,333 & 1.83 & 0.57 \\
20 min & 10,305,860 & 1.92 & 0.54 \\
30 min &  9,653,499 & 2.04 & 0.52 \\
   \hline
\end{tabular}
\caption{Overview of trip data for varying values of $\Tau$.}
\label{t:trips-tau}
\end{table}

Transforming trips into features which can be used in clustering algorithms was a 3-step process:
\begin{enumerate*}[label=(\roman*)]
  \item First, every trip was summarised as a single row of data. The following information was extracted: length of trip, origin, destination, route, start and end times.
  \item Second, daily trip information was obtained for each vehicle: number of trips, median of trip lengths, number of sightings, distinct number of origins destinations, and routes, hour of first sighting, hour of last sighting and total rest time between trips.
  \item Finally, daily information per vehicle was collapsed into a single row by averaging this information across the 15 days.
\end{enumerate*}

Table~\ref{t:features} depicts a sample of the resulting features vector. A total of 1034107 distinct vehicles were detected. However, because a high percentage of trips containing a single sighting, some of these features were highly correlated. We therefore, chose to remove three of the features represented in~\ref{t:features}: \emph{Average Sightings}, \emph{Average Distinct Routes} and \emph{Average Hour Difference}, to avoid the obfuscation of the natural clustering ~\cite{Kmeans}. Furthermore we considered that a trip of length one has no destination (which explains values of average distinct destination below zero) and we filtered all instances of vehicles where the total number of trips is lower than 3, resulting in 642006 unique vehicles.

\begin{table*}[t]
\centering
\begin{tabular}{c c c c c c c c c c c}
  \hline
 \thead{Total\\Trips} & \thead{Average\\Trips} & \thead{Average\\Length} & \thead{Average\\Sightings} & \thead{Average\\Distinct\\Origins} & \thead{Average\\Distinct\\Destinations} & \thead{Average\\Distinct\\Routes} & \thead{Average\\First\\Hour} & \thead{Average\\Last\\Hour} & \thead{Average\\Hour\\Difference} & \thead{Average\\Rest\\Time} \\
  \hline
41 & 3.42 & 1.25 & 5.75 & 2.75 & 1.00 & 3.00 & 15.33 & 19.25 & 3.80 & 3.70 \\
3 & 1.50 & 1.00 & 1.50 & 1.50 & 0.00 & 1.50 & 14.00 & 14.50 & 0.73 & 0.73 \\
7 & 2.33 & 1.33 & 3.33 & 2.33 & 0.67 & 2.33 & 11.00 & 13.00 & 2.44 & 2.41 \\
12 & 2.40 & 1.10 & 3.60 & 2.40 & 0.60 & 2.40 & 14.40 & 16.40 & 2.00 & 1.95 \\
   \hline
\end{tabular}
\caption{Sample of extracted features from trips taken from 15 weekdays of number plate data.}
\label{t:features}
\end{table*}

Clustering of vehicles was performed using the Hartigan and Wong \emph{k-means} algorithm, for each value of $\Tau$. The number of clusters \emph{k} was varied between 2 and 8 and executed with a maximum of 200 iterations and 100 different starting states of the algorithm. The Calinski-Harabasz criterion is used to pick the best value of $k$, the one that minimises the within-cluster and between-cluster errors and provides the more natural clusters ~\cite{Kmeans}. The results of vehicle clustering are presented and discussed in the section below.

\section{Results and Discussion}\label{s.results}

Table~\ref{t:tau_comparison} provides a summary of multiple runs of \emph{k-means} for each value of $\Tau$. The optimal number of clusters, selected by maximising the Calinski-Harabasz criterion, is presented and is shown to decrease inversely with $\Tau$. This in part expected because as $\Tau$ increases, so does the average trip length, as opposed to the total number of trips, and trips per vehicle.  {\color{blue}The interp   ...} The relative between and average within clusters sum of squares is also shown.

Tables~\ref{t:kmeans_centers_450} and~\ref{t:kmeans_centers_1200} depict the cluster centres for $\Tau$ equal to 7.5 minutes and 20 minutes respectively. The values for the cluster centres partially meet our expectations. We were expecting to find a relatively small cluster representing taxis with a high average number of trips per day, occurring over a variety of origins and destinations and over a large time frame. Clusters 2 and 7 for $\Tau = 7.5$ and cluster 4 for $\Tau = 20$ do indeed fit this profile. What differentiates cluster 2 from 7 in the first case is essentially the mean number of trips per day and the average time at which the first and last trips of the day occur. We expected that buses could be separated from taxis by showing less diversity in the number of origins and destinations as these essentially do multiple runs of the same trip throughout the day. Still, this can be explained by the fact that buses take routes through main and secondary roads. As most cameras are placed in main roads, the one long bus trip can be perceived as multiple small trips as the bus alternates between arterial and main roads.

On the other hand, we could expect that commuters display trips starting at around eight in the morning and a second trip terminating between five and six in the evening. Additionally, we would expect to see few trips per day as most of the day is spent in work.

\begin{table}[t]
\centering
\tabcolsep=0.17cm
\begin{tabular}{c c c c c}
  \hline
Tau & Best $k$ & Betweenss & \thead{Average\\Withinss} & \thead{Calinski-\\Harabasz} \\
  \hline
5 min &   8 & 0.923 & 0.125 & 1,116,962 \\
  7.5 min &   7 & 0.904 & 0.143 & 1,003,744 \\
  10 min&   7 & 0.896 & 0.143 &   911,044 \\
  15 min &   6 & 0.865 & 0.167 &   794,557 \\
  20 min &   4 & 0.786 & 0.250 &   754,241 \\
  30 min &   3 & 0.710 & 0.333 &   743,001 \\
   \hline
\end{tabular}
\caption{\emph{k-means} performance for several values of $\Tau$.}
\label{t:tau_comparison}
\end{table}

\begin{table*}[t]
\centering
\small
\begin{tabular}{c c c c c c c c c c}
  \hline
 Cluster &  Size & \thead{Total\\Trips} & \thead{Average\\Trips} & \thead{Average\\Length} & \thead{Average\\Distinct\\Origins} & \thead{Average\\Distinct\\Destinations} & \thead{Average\\First\\Hour} & \thead{Average\\Last\\Hour} & \thead{Average\\Rest\\Time} \\
  \hline
  1 & 108868 & 30.67 & 2.91 & 1.56 & 2.65 & 1.09 & 9.67 & 16.11 & 6.35 \\
  2 & 2948 & 170.08 & 13.69 & 1.47 & 9.20 & 4.67 & 6.89 & 18.69 & 11.65 \\
  3 & 309748 & 5.95 & 2.01 & 1.44 & 1.92 & 0.68 & 12.52 & 14.50 & 1.93 \\
  4 & 163982 & 16.99 & 2.30 & 1.46 & 2.13 & 0.77 & 11.12 & 14.99 & 3.81 \\
  5 & 45414 & 50.30 & 4.26 & 1.52 & 3.67 & 1.57 & 9.04 & 16.86 & 7.69 \\
  6 & 10380 & 86.99 & 7.16 & 1.43 & 5.55 & 2.49 & 8.41 & 17.60 & 9.03 \\
  7 & 666 & 331.50 & 26.43 & 1.57 & 9.31 & 5.17 & 5.73 & 19.59 & 13.14 \\
   \hline
\end{tabular}
\caption{Clusters sizes and centres for $\Tau = 7.5$ minutes.}
\label{t:kmeans_centers_450}
\end{table*}

\begin{table*}[t]
\centering
\small
\begin{tabular}{c c c c c c c c c c}
  \hline
 Cluster &  Size & \thead{Total\\Trips} & \thead{Average\\Trips} & \thead{Average\\Length} & \thead{Average\\Distinct\\Origins} & \thead{Average\\Distinct\\Destinations} & \thead{Average\\First\\Hour} & \thead{Average\\Last\\Hour} & \thead{Average\\Rest\\Time} \\
  \hline
  1 & 371318 & 7.19 & 1.76 & 1.68 & 1.68 & 0.71 & 12.30 & 14.55 & 2.14 \\
    2 & 49852 & 44.85 & 3.73 & 1.90 & 3.16 & 1.73 & 8.98 & 17.02 & 7.76 \\
    3 & 189224 & 22.82 & 2.29 & 1.84 & 2.11 & 1.06 & 10.00 & 15.76 & 5.60 \\
    4 & 4593 & 114.34 & 9.12 & 2.30 & 5.92 & 3.98 & 6.93 & 18.21 & 10.43 \\
   \hline
\end{tabular}
\caption{Clusters sizes and centres for $\Tau = 20$ minutes.}
\label{t:kmeans_centers_1200}
\end{table*}

The differences between expected and observed results are in great part due to the fact that a high percentage of trips contains a single sighting. It may be the case that commuters choose routes that do not pass through ANPR cameras. Devising further models and methods that model and capture this uncertainty is fundamental to getting the most out of ANPR data.
